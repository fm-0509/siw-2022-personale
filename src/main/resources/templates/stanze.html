<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/base.html :: headerfiles(test)">
</head>

<body>
<header th:replace="fragments/base.html :: intestazione"></header>
    <div class="container vh-100">
        <div sec:authorize="hasAnyAuthority('ADMIN')" class="accordion" id="aggiungiStanza">
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-controls="panelsStayOpen-collapseOne">
                        Aggiungi Stanza
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                    <div class="accordion-body">
                        <form class="px-4" th:action="@{/admin/addStanza}" th:method="post">
                            <div class="form-group">
                                <label for="inputNome">Nome</label>
                                <input id="inputNome" class="form-control" type="text" placeholder="Nome" required th:field="${nStanza.nome}"/>
                                <div th:if="${#fields.hasErrors('nStanza.nome')}" th:errors="${nStanza.nome}" th:style="'color:red'"></div>
                            </div>
                            <div class="form-group">
                                <label for="inputTipo">Tipo</label>
                                <input id="inputTipo" class="form-control" type="text" placeholder="Tipo" required th:field="${nStanza.tipo}"/>
                                <div th:if="${#fields.hasErrors('nStanza.tipo')}" th:errors="${nStanza.tipo}" th:style="'color:red'"></div>
                            </div>
                            <div class="form-group">
                                <label for="inputDimensione">Dimensione</label>
                                <input id="inputDimensione" class="form-control" type="text" placeholder="dimensione" required th:field="${nStanza.dimensione}"/>
                                <div th:if="${#fields.hasErrors('nStanza.dimensione')}" th:errors="${nStanza.dimensione}" th:style="'color:red'"></div>
                            </div>
                            <button type="submit" class="btn btn-dark my-1">Aggiungi</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col" th:each="stanz: ${stanze}">
                <div class="card h-100">
                    <!--<img src="..." class="card-img-top" alt="...">-->
                    <div class="card-body">
                        <h5 class="card-title text-center" th:text="${stanz.nome}">Card title</h5>
                        <div class="card-text">
                            <table>
                                <tr>
                                    <th>Tipo</th>
                                    <td class="ps-5" th:text="${stanz.tipo}">tipo</td>
                                </tr>
                                <tr>
                                   <th>Dimensiome</th>
                                   <td class="ps-5" th:text="${stanz.dimensione}">dimensione</td>
                                </tr>
                            </table>
                            <hr>
                            <div class="pt-2 d-flex justify-content-around">
                                <a sec:authorize="hasAnyAuthority('DEFAULT')" class="btn btn-dark py-2" role="button" th:href="@{'/addPrenotazione' + '/' + ${stanz.id}}">Prenota</a>
                                <a sec:authorize="hasAnyAuthority('ADMIN')" class="btn btn-dark py-2 edit-link" role="button" th:attr="data-idStanza=${stanz.id}">Modifica</a>
                                <a sec:authorize="hasAnyAuthority('ADMIN')" class="btn btn-dark py-2 delete-link" role="button" href="#" th:attr="data-idStanza=${stanz.id}">Elimina</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div id="modal_form"></div>
<footer th:replace="fragments/base.html :: footer"></footer>
</body>
<script>
    $(function (){
        $(".delete-link").click(function (e) {
            alert("started");
            e.preventDefault();
           // if(!$(this).data("idStanza"))
             //   return false;
            if(confirm("Eliminare la stanza?"))
                $.ajax(
                    {
                        method : "DELETE",
                        url : "/api/stanza/"+$(this).data("idstanza") ,
                        success: function (response)
                        {
                            if(response.status == 200)
                                location.reload();
                            else
                                $("#alert-ct").html(response.html);
                        },
                        error: function (response) {
                            alert(response.html);
                        }
                    }
                )

        })

        $(".edit-link").click(function (event) {
            event.preventDefault();

            $.get({
                url: "/api/stanzaForm/"+ $(this).data("idstanza"),
                success : function (response)
                {
                    if(response.status == 200)
                    {
                        $("#modal_form").html(response.html);
                        const modal = new bootstrap.Modal('#modal_form');
                        $("#form_modifica").submit(function (e) {
                            e.preventDefault();
                            alert("submitted");
                            modal.hide();

                        })
                        modal.show();

                    }
                }

            })


        })


    })


</script>

</html>